<!DOCTYPE html>
<html lang="zh_CN">
    <head>
  <!-- 元数据 -->
  <meta charset="utf-8">
  <link rel="icon" href="/images/avatar.png">
  <title>SpringMVC进阶使用 | 风的影子</title>
  <meta name="author" content="莫千风" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telphone=no, email=no" />
  
    <meta name="keywords" content="" />
  
  <meta name="description" content="Web MVC相关根据官网文档介绍总结 BindingResultBindingResult作为控制层方法的参数时，它保存了该方法BindingResult之前的参数绑定的结果，和HttpServletRequest对象一样，来自SpringMVC“内部”，暂且称之为“内部参数”，其它需要通过请求参数去转换成java bean的参数称之为“外来参数”。 例：有5个mvc处理器（控制层的方法） 12">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringMVC进阶使用">
<meta property="og:url" content="https://blog.windshadow.cn/SpringMVC%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8/">
<meta property="og:site_name" content="风的影子">
<meta property="og:description" content="Web MVC相关根据官网文档介绍总结 BindingResultBindingResult作为控制层方法的参数时，它保存了该方法BindingResult之前的参数绑定的结果，和HttpServletRequest对象一样，来自SpringMVC“内部”，暂且称之为“内部参数”，其它需要通过请求参数去转换成java bean的参数称之为“外来参数”。 例：有5个mvc处理器（控制层的方法） 12">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.windshadow.cn/images/avatar.png">
<meta property="article:published_time" content="2021-02-15T13:03:17.406Z">
<meta property="article:modified_time" content="2024-08-12T17:20:47.220Z">
<meta property="article:author" content="莫千风">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.windshadow.cn/images/avatar.png">
<meta name="twitter:site" content="@null">
  
  <!-- 站点验证相关 -->
  
    
    
    
  
  <!-- 样式表文件 -->
  <link rel="stylesheet" id="kratos-css" href="/css/kratosr.min.css" type="text/css" media="all">
  
    <link rel="stylesheet" id="highlight-css" href="/css/highlight/night-eighties.min.css" type="text/css" media="all">
  
  
  <link rel="stylesheet" id="fontawe-css" href="/local-cdn/npm/font-awesome@4.7.0/css/font-awesome.min.css" type="text/css" media="all">
  <link rel="stylesheet" id="nprogress-css" href="/local-cdn/npm/nprogress@0.2.0/nprogress.min.css" type="text/css" media="all">
  
  
  
    <link rel="stylesheet" href="/local-cdn/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  
    <link rel="stylesheet" id="darkmode-css" href="/css/kr-dark.min.css" type="text/css" media="all">
  
  <!-- 不得不预先加载的一些JS文件 -->
  <script src="/local-cdn/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  
    <script src="/local-cdn/npm/qrcode_js@1.0.0/qrcode.min.js"></script>
  
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="风的影子" type="application/atom+xml">
</head>


    <body class="custom-background">
        <div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <header id="kratos-desktop-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="nav-header">
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">
                                
                                    
                                        <li><a href="/"><i class="fa fa-home"></i>首页</a></li>
                                    
                                
                                    
                                        <li><a href="/archives/"><i class="fa fa-book"></i>档案馆</a></li>
                                    
                                
                                    
                                        <li><a href="/ws-springx"><i class="fa fa-code" aria-hidden="true" /></i>ws-springx</a></li>
                                    
                                
                                    
                                        <li><a href="/friends/"><i class="fa fa-paw"></i>好伙伴</a></li>
                                    
                                
                                    
                                        <li><a href="/warehouse"><i class="fa fa-star"></i>仓库</a></li>
                                    
                                
                                    
                                        <li><a href="/game"><i class="fa fa-gamepad"></i>游戏</a></li>
                                    
                                
                                    
                                        <li>
                                            <a><i class="fa fa-link"></i>链接</a>
                                            <ul class="sub-menu">
                                                
                                                    
                                                
                                                    
                                                        <li><a href="https://blog.csdn.net/WindMo356">CSDN博客</a></li>
                                                    
                                                
                                            </ul>
                                        </li>
                                    
                                
                                    
                                        <li><a href="/wind"><i class="fa fa-paper-plane"></i>风</a></li>
                                    
                                
                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
            <header id="kratos-mobile-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="color-logo"><a href="/">风的影子</a></div>
                    <div class="nav-toggle">
                        <a class="kratos-nav-toggle js-kratos-nav-toggle">
                            <i></i>
                        </a>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2>风的影子</h2> <br />
                        <span>莫千风</span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">
                    
                        

<section id="kratos-widget-area" class="col-md-4 hidden-xs hidden-sm">
    <!-- 文章和页面根据splitter来分割，没有的话就从头开始设置为sticky -->
    
    
                <aside id="krw-about" class="widget widget-kratos-about clearfix">
    <div class="photo-background"></div>
    <div class="photo-wrapper clearfix">
        <div class="photo-wrapper-tip text-center">
            <img class="about-photo" src="/images/avatar.png" />
        </div>
    </div>
    <div class="textwidget">
        <p class="text-center">且听风吟 御剑于心</p>
    </div>
</aside>
            
                    <div class="sticky-area">
                
                
  <aside id="krw-categories" class="widget widget-kratos-categories clearfix">
    <h4 class="widget-title"><i class="fa fa-folder"></i>分类目录</h4>
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/Garbage-Collection/">Garbage Collection</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/">Java多线程</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8E%9F%E7%90%86/">Java线程池原理</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E7%89%B9%E9%A1%B9/">Java特项</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MyBatis/">MyBatis</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/MyBatis/MyBatis%E6%BA%90%E7%A0%81/">MyBatis源码</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySql/">MySql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web%E5%9F%BA%E7%A1%80/">web基础</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1/">分布式与微服务</a><span class="category-list-count">1</span></li></ul>
  </aside>


            
                
            
                
  <aside id="krw-posts" class="widget widget-kratos-posts">
  <h4 class="widget-title"><i class="fa fa-file"></i>最新文章</h4>
  <div class="tab-content">
      <ul class="list-group">
        
        
          
          
            <a class="list-group-item" href="/SpringWeb%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"><i class="fa  fa-book"></i> SpringWeb异常处理</a>
            
          
        
          
          
            <a class="list-group-item" href="/Spring%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C%E4%BD%93%E7%B3%BB/"><i class="fa  fa-book"></i> Spring数据校验体系</a>
            
          
        
          
          
            <a class="list-group-item" href="/TLS%E8%AF%81%E4%B9%A6%E4%B8%8E%E8%87%AA%E7%AD%BEca/"><i class="fa  fa-book"></i> TLS证书与自签ca</a>
            
          
        
          
          
            <a class="list-group-item" href="/BeanValidation/"><i class="fa  fa-book"></i> Bean Validation</a>
            
          
        
          
          
            <a class="list-group-item" href="/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%85%A5%E9%97%A8/"><i class="fa  fa-book"></i> JVM垃圾回收入门</a>
            
          
        
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
      </ul>
  </div>
  </aside>

            
    </div>
</section>
                    

        

            <section class="col-md-8">

        

            <article>
    <div class="kratos-hentry kratos-post-inner clearfix">
        <header class="kratos-entry-header">
            
                <h1 class="kratos-entry-title text-center">SpringMVC进阶使用</h1>
            
            
            <ul class="kratos-post-meta text-center">
                <li><i class="fa fa-calendar"></i> 2021-02-15</li>
                <li><i class="fa fa-user"></i> 作者 莫千风</li>
                <li>
                    <i class="fa fa-edit"></i> 
                    
                    
                        ~20.25K
                    
                    字
                </li>
                
            </ul>
        </header>
        <div class="kratos-post-content">
            <div id="expire-alert" class="alert alert-warning hidden" role="alert">
                本文最后编辑于 <time datetime="1723483247220"></time> 前，其中的内容可能需要更新。
            </div>
            
            <hr />
            <h1 id="Web-MVC相关"><a href="#Web-MVC相关" class="headerlink" title="Web MVC相关"></a>Web MVC相关</h1><p>根据官网文档介绍总结</p>
<h2 id="BindingResult"><a href="#BindingResult" class="headerlink" title="BindingResult"></a>BindingResult</h2><p>BindingResult作为控制层方法的参数时，它保存了该方法BindingResult之前的参数绑定的结果，和HttpServletRequest对象一样，来自SpringMVC“内部”，暂且称之为“内部参数”，其它需要通过请求参数去转换成java bean的参数称之为“外来参数”。</p>
<p>例：有5个mvc处理器（控制层的方法）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">xxxController</span>()  &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/url0&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> xxx <span class="title function_">method0</span><span class="params">(User user,Dept dept)</span> &#123;</span><br><span class="line">   	 <span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">   </span><br><span class="line">	 <span class="meta">@RequestMapping(&quot;/url1&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> xxx <span class="title function_">bindMethod1</span><span class="params">(User user,BindingResult bindingResult)</span> &#123;</span><br><span class="line">    	<span class="keyword">if</span> (bindingResult.hasErrors()) &#123;</span><br><span class="line">            Map&lt;String , String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">     		<span class="comment">// 遍历获取检验不通过的属性名以及抛出对应异常的message</span></span><br><span class="line">            bindingResult.getFieldErrors().forEach( (item) -&gt; &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> item.getDefaultMessage();</span><br><span class="line">                <span class="type">String</span> <span class="variable">field</span> <span class="operator">=</span> item.getField();</span><br><span class="line">                map.put( field , message );</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">   	 <span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/url3&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> xxx <span class="title function_">bindMethod2</span><span class="params">(User user,Dept dept,BindingResult bindingResult)</span> &#123;</span><br><span class="line">   	 <span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">     <span class="meta">@RequestMapping(&quot;/url3&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> xxx <span class="title function_">bindMethod3</span><span class="params">(User user,BindingResult bindingResult,Dept dept)</span> &#123;</span><br><span class="line">   	 <span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">     <span class="meta">@RequestMapping(&quot;/url4&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> xxx <span class="title function_">integerMethod5</span><span class="params">(User user,Integer size)</span> &#123;</span><br><span class="line">   	 <span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码中，method0都熟悉了，前端参数直接绑定，找不到的参数则直接为默认值，而当参数转换错误时，即前端传入了非数字的字符串， 而后端要转换成Integer类型，如{id : 123abc}要转换到User对象的id属性，此时mvc会抛出绑定参数相关的异常（<strong>BindException</strong> ，该异常可获取到BindingResult对象），此时前端便会收到400状态码的应答。</p>
<p>而在bindMethod1中，BindingResult对像则保存了mvc绑定user对象的结果：有无错误、错误的属性field和错误信息message等；因为处理器显式声明了BindingResult对像作为形参，所以上述由绑定异常导致的400错误不会发生，继续进入处理器方法执行业务。</p>
<ul>
<li>在bindMethod2和bindMethod3中，处理器需要绑定2个bean到实参，经验证执行过程如下：</li>
</ul>
<ol>
<li><p>从左到右先绑定User，若绑定失败则抛出参数绑定相关的异常</p>
</li>
<li><p>绑定User通过，绑定Dept失败，进入控制层方法，BindingResult保存id绑定结果</p>
</li>
<li><p>绑定都通过，进入控制层方法，BindingResult保存Dept绑定结果</p>
<p>故而得出：<strong>BindingResult保存的绑定结果是处理器（控制层的方法）最后一个bean参数的绑定结果【一对一绑定】</strong></p>
</li>
</ol>
<ul>
<li>在integerMethod5中，有一个普通数据类型的形参，如果对其转换失败时，mvc则直接抛出方法参数类型匹配异常（<strong>MethodArgumentTypeMismatchException</strong>），注意不是绑定异常。</li>
</ul>
<p>稍加思考不难得出，mvc处理器参数处理的简单流程：</p>
<p><img src="/SpringMVC%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8/mvc%E7%BB%91%E5%AE%9A%E6%B5%81%E7%A8%8B.png" alt="mvc绑定流程"></p>
<p>当我们需要关心客户端传入bean参数的对错时，可以在处理器上使用BindingResult对象，不关心则不需要，直接让mvc自动返回400错误。一般情况下，很少使用BindingResult对象，BindingResult更多的是在参数绑定相关异常中作为绑定结果信息的载体，通过BindingResult先打一下mvc的基础。</p>
<h2 id="ControllerAdvice"><a href="#ControllerAdvice" class="headerlink" title="@ControllerAdvice"></a>@ControllerAdvice</h2><p>顾名思义，控制器增强，原理是AOP，结合控制层能干的事和AOP方可理解其作用，不多BB。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice(</span></span><br><span class="line"><span class="meta">    basePackageClasses = &#123;xxxController.class&#125;)</span><span class="comment">// 只切入指定的类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionHandlerAdvice</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="InitBinder参数绑定"><a href="#InitBinder参数绑定" class="headerlink" title="@InitBinder参数绑定"></a>@InitBinder参数绑定</h2><h3 id="PropertyEditor"><a href="#PropertyEditor" class="headerlink" title="PropertyEditor"></a>PropertyEditor</h3><p>先了解这个，<a target="_blank" rel="noopener" href="https://blog.csdn.net/pentiumchen/article/details/44026575">PropertyEditor的使用和原理</a></p>
<p>@InitBinder可以实现参数绑定，将String类型的数据转换成对应的java对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InitBinderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/initBinder/date&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">(Date date)</span> &#123;</span><br><span class="line"></span><br><span class="line">        String str;</span><br><span class="line">        <span class="keyword">if</span> (date == <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">            str = <span class="string">&quot;date is null&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            str = date.toString();</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(str);</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/initBinder/bigDecimal&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test2</span><span class="params">(<span class="meta">@RequestParam(&quot;bigDecimal&quot;)</span> BigDecimal number)</span> &#123;</span><br><span class="line"></span><br><span class="line">        String str;</span><br><span class="line">        <span class="keyword">if</span> (number == <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">            str = <span class="string">&quot;number is null&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">           str  = number.toString();</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(str);</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InitBinder</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initBinder</span><span class="params">(WebDataBinder binder)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">dateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        dateFormat.setLenient(<span class="literal">false</span>);</span><br><span class="line">        binder.registerCustomEditor(Date.class, <span class="keyword">new</span> <span class="title class_">CustomDateEditor</span>(dateFormat, <span class="literal">false</span>));</span><br><span class="line">        <span class="comment">// 注册自定义的 大小数转换器</span></span><br><span class="line">        binder.registerCustomEditor(BigDecimal.class,<span class="keyword">new</span> <span class="title class_">BigDecimalEditor</span>());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>WebDataBinder实现了PropertyEditorRegistry接口，所以只需要注册CustomDateEditor解析器和自定义的大小数转换器（下见代码）就可以了。</p>
<p>自定义参数转换器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> WindShadow</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 2020/9/20.</span></span><br><span class="line"><span class="comment"> * 大小数转换器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BigDecimalEditor</span> <span class="keyword">extends</span> <span class="title class_">PropertyEditorSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAsText</span><span class="params">(String text)</span> <span class="keyword">throws</span> IllegalArgumentException &#123;</span><br><span class="line"></span><br><span class="line">        BigDecimal bigDecimal;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bigDecimal = BigDecimal.valueOf(Double.valueOf(text));</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        setValue(bigDecimal);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>简而言之@InitBinder：控制层方法参数映射，String &#x3D;&gt; Java Object（一对一）</strong></p>
<p><strong>@ControllerAdvice + @InitBinder &#x3D; 被增强的Controller都拥有共同的数据绑定器</strong></p>
<p>更详细的参数绑定原理的博客：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/yourbatman/p/11218694.html">https://www.cnblogs.com/yourbatman/p/11218694.html</a></p>
<h2 id="ExceptionHandler异常处理"><a href="#ExceptionHandler异常处理" class="headerlink" title="@ExceptionHandler异常处理"></a>@ExceptionHandler异常处理</h2><h3 id="几种异常处理方式"><a href="#几种异常处理方式" class="headerlink" title="几种异常处理方式"></a>几种异常处理方式</h3><p>先大致了解一下<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenzhubing/p/11438902.html">百度上的3中异常处理方式</a></p>
<p>可得：大致有以下几种异常处理方式</p>
<ol>
<li>手动try-catch，自己返回对应视图或数据【原始操作，颗粒细，代码臃肿，分支多】</li>
<li>Controller + @ExceptionHandler【只能在当前控制器中处理异常】</li>
<li>BaseController + @ExceptionHandler + 继承【类似 2，但因为继承，具有统一异常处理能力】</li>
<li>实现 HandlerExceptionResolver 接口【可实现统一异常处理】</li>
<li>@ControllerAdvice + @ExceptionHandler 【AOP原理，可实现统一异常处理】</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-ann-exceptionhandler">@ExceptionHandler支持的参数和返回值类型</a>；</p>
<p>意思你在@ExceptionHandler的异常处理方法下的操作，类似在@RequestMapping方法下的操作，但是仅限于文档上指明的方法参数类型和返回值。和@RequestMapping一样，返回String依旧默认是视图名称，方法加上@ResponseBody就是json形式返回。</p>
<p>注意：方法参数为map等具有往视图添加数据的类型时，方法被调用时会报错</p>
<h3 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h3><p>既然在SpringMVC中有多种处理异常的方式，那么就存在一个优先级的问题：</p>
<p>当发生异常的时候，SpringMVC会如下处理：</p>
<p>（1）SpringMVC会先从配置文件找异常解析器HandlerExceptionResolver</p>
<p>（2）如果找到了异常异常解析器，那么接下来就会判断该异常解析器能否处理当前发生的异常</p>
<p>（3）如果可以处理的话，那么就进行处理，然后给前台返回对应的异常视图</p>
<p>（4）如果没有找到对应的异常解析器或者是找到的异常解析器不能处理当前的异常的时候，就看当前的Controller中有没有提供对应的异常处理器，如果提供了就由Controller自己进行处理并返回对应的视图</p>
<p>（5）如果配置文件里面没有定义对应的异常解析器，而当前Controller中也没有定义的话，就看有没有全局ControllerAdvice提供的全局异常处理器，如果没有那么该异常就会被抛出来</p>
<h2 id="Valid数据校验"><a href="#Valid数据校验" class="headerlink" title="@Valid数据校验"></a>@Valid数据校验</h2><p>前提了解：<a target="_blank" rel="noopener" href="https://developer.ibm.com/zh/articles/j-lo-jsr303/"><strong>JSR303数据校验</strong></a></p>
<h3 id="JSR303注解小细节"><a href="#JSR303注解小细节" class="headerlink" title="JSR303注解小细节"></a>JSR303注解小细节</h3><p>设定一个pojo，下面的字段中，如果前端没有传过来email字段，也就是得到User对象的email属性为null，这是允许的，等同于【选填，格式必须为邮箱】，如果在@Email上再加入@NotNull，即叠加校验，等同于【必填，格式必须为邮箱】，<strong>叠加校验校验顺序从上往下</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@NotNull</span> <span class="comment">// 该字段不能为空</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">  <span class="comment">//  @NotNull // 注解可叠加使用</span></span><br><span class="line">    <span class="meta">@Email</span> <span class="comment">// 该字段必须是邮箱格式</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="控制层写法"><a href="#控制层写法" class="headerlink" title="控制层写法"></a>控制层写法</h3><h4 id="参数-BindingResult对象"><a href="#参数-BindingResult对象" class="headerlink" title="参数 + BindingResult对象"></a>参数 + BindingResult对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@RequestMapping(&quot;/url&quot;)</span></span><br><span class="line"><span class="keyword">public</span> xxx <span class="title function_">validTest1</span><span class="params">(<span class="meta">@Valid</span> User user,BindingResult bindingResult)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (bindingResult.hasErrors()) &#123;</span><br><span class="line">            Map&lt;String , String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">     		<span class="comment">// 遍历获取检验不通过的属性名以及抛出对应异常的message</span></span><br><span class="line">            bindingResult.getFieldErrors().forEach( (item) -&gt; &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> item.getDefaultMessage();</span><br><span class="line">                <span class="type">String</span> <span class="variable">field</span> <span class="operator">=</span> item.getField();</span><br><span class="line">                map.put( field , message );</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// …   </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Valid 开启校验功能，紧跟在校验的Bean后添加一个BindingResult，BindingResult会封装前面Bean的校验结果，可见参数校验结果是被视为 参数校验结果的子集。这种处理器的写法缺点很明显，每个需要参数校验的地方都用 BindingResult 获取校验结果。冷门操作。</p>
<h4 id="结合-ExceptionHandler"><a href="#结合-ExceptionHandler" class="headerlink" title="结合@ExceptionHandler"></a>结合@ExceptionHandler</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@RequestMapping(&quot;/url&quot;)</span></span><br><span class="line"><span class="keyword">public</span> xxx <span class="title function_">validTest1</span><span class="params">(<span class="meta">@Valid</span> User user)</span> &#123;</span><br><span class="line">    <span class="comment">// 正常业务...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ResponseStatus(value = HttpStatus.BAD_GATEWAY,reason = &quot;bind异常&quot;)</span><span class="comment">// 以此状态码作为最终响应状态码，若不配置，处理完异常后以正常的200响应</span></span><br><span class="line"><span class="meta">@ExceptionHandler(value = &#123;</span></span><br><span class="line"><span class="meta">    MethodArgumentNotValidException.class,// @RequestBody 参数映射验证失败抛出此类型异常</span></span><br><span class="line"><span class="meta">    BindException.class,// get、post等参数自动绑定到bean的请求方式时，验证失败抛出此类型异常</span></span><br><span class="line"><span class="meta">    ConstraintViolationException.class//  @RequestParam 参数映射验证失败抛出此类型异常</span></span><br><span class="line"><span class="meta"> &#125;)</span></span><br><span class="line"><span class="keyword">public</span> xxx <span class="title function_">validErrEx</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (e <span class="keyword">instanceof</span> MethodArgumentNotValidException) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;MethodArgumentNotValidException&quot;</span>);</span><br><span class="line">        <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> ((MethodArgumentNotValidException)e).getBindingResult();</span><br><span class="line">       	<span class="comment">// ...</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> BindException) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;BindException&quot;</span>);</span><br><span class="line">        <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> ((BindException)e).getBindingResult();</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ConstraintViolationException) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;ConstraintViolationException&quot;</span>);</span><br><span class="line">        Set&lt;ConstraintViolation&lt;?&gt;&gt; constraintViolationSet =((ConstraintViolationException)e).getConstraintViolations();</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// @ExceptionHandler注解限定了异常类型，此句不可能被执行到</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;未知异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="数据校验不起作用的写法"><a href="#数据校验不起作用的写法" class="headerlink" title="数据校验不起作用的写法"></a>数据校验不起作用的写法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@RequestMapping(&quot;/url&quot;)</span></span><br><span class="line"><span class="keyword">public</span> xxx <span class="title function_">validTest1</span><span class="params">(<span class="meta">@Valid</span> User user, <span class="meta">@Email</span> String emaill)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"> <span class="meta">@RequestMapping(&quot;/url&quot;)</span></span><br><span class="line"><span class="keyword">public</span> xxx <span class="title function_">validTest2</span><span class="params">(<span class="meta">@Valid</span> User user, <span class="meta">@Valid</span> <span class="meta">@Email</span> String email)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>直接验证基本数据类型是无效的；</strong>可以这样理解：@Valid作用于bean上，表示对此bean开启JSR303数据检验，bean中所有被JSR303注解作用的属性都会被检验。</p>
<h4 id="多参数验证顺序"><a href="#多参数验证顺序" class="headerlink" title="多参数验证顺序"></a>多参数验证顺序</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/url&quot;)</span></span><br><span class="line"><span class="keyword">public</span> xxx <span class="title function_">validTest1</span><span class="params">(<span class="meta">@Valid</span> User user, <span class="meta">@Valid</span> Dept dept)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>和参数绑定一样，验证顺序从左到右，由此可见<strong>参数校验属于参数绑定的子过程</strong>。</p>
<h2 id="Validated数据校验"><a href="#Validated数据校验" class="headerlink" title="@Validated数据校验"></a>@Validated数据校验</h2><p>@Valid是java的注解（javax.validation包下），@Validated是Spring的注解，Spring对@Validated的功能支持包含了@Valid的支持，即在Spring环境中，@Valid能干的@Validated都能干，所以在控制层的数据校验时，也可用@Validated代替@Valid。另外Spring对@Validated提供了分组校验</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Validated &#123;</span><br><span class="line">    Class&lt;?&gt;[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="分组校验"><a href="#分组校验" class="headerlink" title="分组校验"></a>分组校验</h3><p>场景：User bean在新增操作时，id要为空，更新操作时id不能为空。@Valid没有分组功能，@Validated拥有分组功能。</p>
<p>建立分组类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Group</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Insert</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Update</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>User bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">// 校验时分组</span></span><br><span class="line">  	<span class="meta">@Null(groups = &#123;Group.Insert.class&#125;)</span></span><br><span class="line">    <span class="meta">@NotNull(groups = &#123;Group.Insert.class&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Double money;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制层写法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/url&quot;)</span></span><br><span class="line"><span class="keyword">public</span> xxx <span class="title function_">addUser</span><span class="params">(<span class="meta">@Validated(Group.Insert.class)</span> User user)</span> &#123;</span><br><span class="line">    <span class="comment">// 正常业务...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义校验注解"><a href="#自定义校验注解" class="headerlink" title="自定义校验注解"></a>自定义校验注解</h3><p>实现类似上述@Email @Null的检验注解，以行数据逻辑删除属性为例</p>
<p>行数据类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RowData</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">DELETED</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">NOT_DELETED</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@MyDeletedCodeValidated</span></span><br><span class="line">    <span class="keyword">private</span> Integer deleted;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getDeleted</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> deleted;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDeleted</span><span class="params">(Integer deleted)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.deleted = deleted;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;RowData&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;deleted=&quot;</span> + deleted +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>校验注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;FIELD, ANNOTATION_TYPE, PARAMETER&#125;)</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 表示处理的这个注解的类是哪一个，可以是多个</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = MyConstraintValidator.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyDeletedCodeValidated &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下面的这俩是必须的</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>处理检验注解的类，必须实现ConstraintValidator接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConstraintValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;MyDeletedCodeValidated,Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MyDeletedCodeValidated constraintAnnotation)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.message = constraintAnnotation.message();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(Integer code, ConstraintValidatorContext context)</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (!RowData.DELETED.equals(code) &amp;&amp; !RowData.NOT_DELETED.equals(code)) &#123;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// 禁用默认的消息模板</span></span><br><span class="line">           context.disableDefaultConstraintViolation();</span><br><span class="line">           <span class="comment">// 设置自己的消息模板</span></span><br><span class="line">           context.buildConstraintViolationWithTemplate(<span class="string">&quot;&quot;</span>.equals(message) ? <span class="string">&quot;删除代号只能为0或1&quot;</span> : message)</span><br><span class="line">                   .addConstraintViolation();</span><br><span class="line">           <span class="comment">//不合法，不通过</span></span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制层直接使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">@RequestMapping(&quot;/rowData&quot;)</span></span><br><span class="line">  <span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">rowDataValidated</span><span class="params">(<span class="meta">@Validated</span> RowData rowData)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rowData == <span class="literal">null</span> ? <span class="string">&quot;null&quot;</span> : rowData.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义校验器"><a href="#自定义校验器" class="headerlink" title="自定义校验器"></a>自定义校验器</h3><p>定义一个Gender类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Gender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAN</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">WOMAN</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Gender</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Gender</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现对应的校验器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对&#123;<span class="doctag">@link</span> Gender&#125;类的校验器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> WindShadow</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 2021-10-21.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenderValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Gender.class.equals(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(Object target, Errors errors)</span> &#123;</span><br><span class="line"></span><br><span class="line">        ValidationUtils.rejectIfEmpty(errors,<span class="string">&quot;code&quot;</span>,<span class="string">&quot;code is empty&quot;</span>);</span><br><span class="line">        <span class="type">Gender</span> <span class="variable">gender</span> <span class="operator">=</span> (Gender) target;</span><br><span class="line">        <span class="keyword">if</span> (Gender.MAN != gender.getCode() &amp;&amp; Gender.WOMAN != gender.getCode()) &#123;</span><br><span class="line"></span><br><span class="line">            errors.reject(String.format(<span class="string">&quot;性别代码只能为%s = 男，%s = 女&quot;</span>,<span class="number">1</span>,<span class="number">0</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制层注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/gender&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">genderValidated</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> Gender gender)</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> gender == <span class="literal">null</span> ? <span class="string">&quot;null&quot;</span> : gender.toString();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@InitBinder(&quot;gender&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initBinder</span><span class="params">(WebDataBinder binder)</span> &#123;</span><br><span class="line"></span><br><span class="line">   binder.addValidators(<span class="keyword">new</span> <span class="title class_">GenderValidator</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="MatrixVariable-矩阵变量"><a href="#MatrixVariable-矩阵变量" class="headerlink" title="@MatrixVariable 矩阵变量"></a>@MatrixVariable 矩阵变量</h2><p> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/panchanggui/p/9436348.html">RFC3986</a>定义了在URI中包含name-value的规范 。</p>
<p>使用@MatrixVariable可以方便的进行多条件组合查询</p>
<h3 id="开启矩阵变量功能"><a href="#开启矩阵变量功能" class="headerlink" title="开启矩阵变量功能"></a>开启矩阵变量功能</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">     <span class="comment">// 矩阵变量配置,关键类UrlPathHelper</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">UrlPathHelper</span> <span class="variable">urlPathHelper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlPathHelper</span>();</span><br><span class="line">        urlPathHelper.setRemoveSemicolonContent(<span class="literal">false</span>);<span class="comment">// 必须 false</span></span><br><span class="line">        configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xml中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">enable-matrix-variables</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>官方例子：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/web.html#mvc-ann-matrix-variables">https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/web.html#mvc-ann-matrix-variables</a></p>
<ol>
<li><p>handler入参为Map&lt;String,String&gt; 和 Map&lt;String,List<String></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MatrixController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// /matrix/user/userls;id=100;name=ls;age=18;address=nj/com/alibaba;id=1001;address=hz;dept=dept001,dept002</span></span><br><span class="line">    <span class="comment">// /matrix/user/userls;id=100;name=ls;age=18;address=nj/com/alibaba;id=1001;address=hz;dept=dept001;dept=dept002</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/matrix/user/&#123;user&#125;/com/&#123;com&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">matrix1</span><span class="params">(<span class="meta">@PathVariable(&quot;user&quot;)</span> String user, <span class="meta">@PathVariable(&quot;com&quot;)</span> String com,</span></span><br><span class="line"><span class="params">                          <span class="meta">@MatrixVariable(pathVar = &quot;user&quot;)</span> Map&lt;String,String&gt; userInfo,</span></span><br><span class="line"><span class="params">                          <span class="meta">@MatrixVariable(pathVar = &quot;com&quot;)</span> Map&lt;String,List&lt;String&gt;&gt; comInfo)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> user + <span class="string">&quot;\n&quot;</span> + com + <span class="string">&quot;\n&quot;</span> + JSON.toJSONString(userInfo) + <span class="string">&quot;\n&quot;</span> + JSON.toJSONString(comInfo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p> 返回结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">userls</span><br><span class="line">alibaba</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;ls&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="string">&quot;18&quot;</span><span class="punctuation">,</span><span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="string">&quot;nj&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;1001&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;hz&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;dept&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;dept001&quot;</span><span class="punctuation">,</span><span class="string">&quot;dept002&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>handler入参为普通简单类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MatrixController</span> &#123;</span><br><span class="line">    <span class="comment">// /matrix2/user/userls;id=100;name=ls;age=18;address=nj</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/matrix2/user/&#123;user&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">matrix2</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@MatrixVariable(pathVar = &quot;user&quot;,name = &quot;name&quot;)</span> String name,</span></span><br><span class="line"><span class="params">            <span class="meta">@MatrixVariable(pathVar = &quot;user&quot;,name = &quot;age&quot;)</span> Integer age,</span></span><br><span class="line"><span class="params">            <span class="meta">@MatrixVariable(pathVar = &quot;user&quot;,name = &quot;id&quot;)</span> Integer id,</span></span><br><span class="line"><span class="params">            <span class="meta">@MatrixVariable(pathVar = &quot;user&quot;,name = &quot;address&quot;)</span> String address)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name + <span class="string">&quot;\n&quot;</span> + age + <span class="string">&quot;\n&quot;</span> + id + <span class="string">&quot;\n&quot;</span> + address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br><span class="line"><span class="number">18</span></span><br><span class="line"><span class="number">100</span></span><br><span class="line">nj</span><br></pre></td></tr></table></figure>
</li>
<li><p>URL + ? + 参数</p>
<p>对比 2 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MatrixController</span> &#123;</span><br><span class="line">     <span class="comment">// /matrix2/user/userls;id=100;name=ls;age=18;address=nj?car=lbjn</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/matrix3/user/&#123;user&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">matrix3</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@MatrixVariable(pathVar = &quot;user&quot;,name = &quot;name&quot;)</span> String name,</span></span><br><span class="line"><span class="params">            <span class="meta">@MatrixVariable(pathVar = &quot;user&quot;,name = &quot;age&quot;)</span> Integer age,</span></span><br><span class="line"><span class="params">            <span class="meta">@MatrixVariable(pathVar = &quot;user&quot;,name = &quot;id&quot;)</span> Integer id,</span></span><br><span class="line"><span class="params">            <span class="meta">@MatrixVariable(pathVar = &quot;user&quot;,name = &quot;address&quot;)</span> String address,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam</span> String car)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name + <span class="string">&quot;\n&quot;</span> + age + <span class="string">&quot;\n&quot;</span> + id + <span class="string">&quot;\n&quot;</span> + address + <span class="string">&quot;\n&quot;</span> + car;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br><span class="line"><span class="number">18</span></span><br><span class="line"><span class="number">100</span></span><br><span class="line">nj</span><br><span class="line">lbjn</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="注意点："><a href="#注意点：" class="headerlink" title="注意点："></a>注意点：</h3><ol>
<li>显然的，如url &#x3D; <u>&#x2F;matrix&#x2F;user&#x2F;userls;id&#x3D;100;name&#x3D;ls;age&#x3D;18;address&#x3D;nj&#x2F;com&#x2F;alibaba;id&#x3D;1001;address&#x3D;hz;dept&#x3D;dept001,dept002</u>。分号开始的地方当作一个矩阵，遇到一些非矩阵符号（如 &#x2F; 或 ? ，它们是正常url里有特别意义的字符）时，矩阵视为结束。</li>
<li>URL格式<ul>
<li>dept&#x3D;dp01;dept&#x3D;dp02 等价于 dept&#x3D;dp01,dp02</li>
<li><u>&#x2F;matrix3&#x2F;user&#x2F;userls;?car&#x3D;lbjn</u> 此种格式绑定到 @PathVariable(“user”) String user  参数时，user值为 userls; </li>
<li><u>&#x2F;matrix3&#x2F;user&#x2F;userls;age&#x3D;18;?car&#x3D;lbjn</u> 和  <u>&#x2F;matrix3&#x2F;user&#x2F;userls;age&#x3D;18?car&#x3D;lbjn</u> 这两种格式的差别在 ? 之前的分号，但是他们都能正常绑定到参数。即 age 值为 18 而不是 18;</li>
</ul>
</li>
<li>根据 1 2可知，如url &#x3D; <u>&#x2F;matrix3&#x2F;user&#x2F;userls;?car&#x3D;lbjn</u>处理器有@PathVariable(“user”) String user。矩阵user并不被认为存在，所以矩阵参数开始的字符是分号 <em>；</em> 。这一点不注意可能会被误导。</li>
<li>@MatrixVariable(pathVar &#x3D; “user”,name &#x3D; “name”)中，显然 pathVar 代表参数所在的矩阵，只有一个矩阵时也可省略</li>
<li>@MatrixVariable(required &#x3D; false)表示此参数可以不存在，即required属性控制参数是否必填</li>
<li>@MatrixVariable(defaultValue &#x3D; “value”)，通过defaultValue属性表示缺省值</li>
<li>使用@MatrixVariable后，传入分号作为参数值时需要转义编码啥的，具体转义规则啥的看RFC3986来吧，目前百度上也没看到有个完美可行的说法，可能大多数人矩阵变量用的不是也别多，个人感觉挺方便的</li>
</ol>
<h2 id="ModelAttribute"><a href="#ModelAttribute" class="headerlink" title="@ModelAttribute"></a>@ModelAttribute</h2><p>@ModelAttribute注解用于将方法的参数或方法的返回值绑定到指定的模型属性上，并返回给Web视图。被@ModelAttribute注解注释的方法会在此controller每个handler方法（处理器）执行前被执行，因此对于一个controller映射多个URL的用法来说，要谨慎使用。</p>
<ol>
<li><p>例A：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModelAttributeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ModelAttribute</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">modelVoid</span><span class="params">(Model model)</span> &#123;<span class="comment">// 返回值为void时，入参没有 Model类型会报错</span></span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">&quot;void&quot;</span>,<span class="string">&quot;voidString&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@ModelAttribute(&quot;@ModelAttributeKey&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">model</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;@ModelAttributeValue&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/modelAttribute&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">show</span><span class="params">(Model model)</span> &#123;</span><br><span class="line"></span><br><span class="line">    	log.info(<span class="string">&quot;modelData: &#123;&#125;&quot;</span>, JSON.toJSON(model.asMap()));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;show&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modelData<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;@ModelAttributeKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;@ModelAttributeValue&quot;</span><span class="punctuation">,</span><span class="attr">&quot;void&quot;</span><span class="punctuation">:</span><span class="string">&quot;voidString&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>例B</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModelAttributeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ModelAttribute</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">modelVoid</span><span class="params">(Model model)</span> &#123;<span class="comment">// 返回值为void时，入参没有 Model类型会报错</span></span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">&quot;void&quot;</span>,<span class="string">&quot;voidString&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> 	<span class="meta">@RequestMapping(value = &quot;/modelAttribute3&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">show3</span><span class="params">(<span class="meta">@ModelAttribute(&quot;void&quot;)</span> String voidString)</span> &#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;voidString: &#123;&#125;&quot;</span>,voidString);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;show&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">voidString<span class="punctuation">:</span> voidString</span><br></pre></td></tr></table></figure>


</li>
<li><p>例C</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModelAttributeController</span> &#123;</span><br><span class="line"></span><br><span class="line"> 	 <span class="comment">// 此时 user 来自前端 User必须有无参构造</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/addUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">show3</span><span class="params">(<span class="meta">@ModelAttribute(&quot;void&quot;)</span> User user)</span> &#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;user: &#123;&#125;&quot;</span>,user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;show&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>例D</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModelAttributeController</span> &#123;  </span><br><span class="line">	<span class="comment">// 此时，@RequestMapping内的value表示视图名称，即 show</span></span><br><span class="line">    <span class="comment">// 请求此url后，后端将渲染 show 的视图页面并返回，该视图的 model有键值对 attributeName=hi</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/show&quot;)</span></span><br><span class="line">    <span class="meta">@ModelAttribute(&quot;attributeName&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hi&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="RequestAttribute"><a href="#RequestAttribute" class="headerlink" title="@RequestAttribute"></a>@RequestAttribute</h2><p>参照@ModelAttribute的使用，只不过数据放的域不同，此时数据存放于request域，即 request.setAttribute()</p>
<h2 id="SessionAttribute"><a href="#SessionAttribute" class="headerlink" title="@SessionAttribute"></a>@SessionAttribute</h2><p>参照@ModelAttribute的使用，只不过数据放的域不同，此时数据存放于session域，即 session.setAttribute()</p>

        </div>
        
            <div class="kratos-copyright text-center clearfix">
                <h5>本作品采用 <a rel="license nofollow" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a> 进行许可</h5>
            </div>
        
        <footer class="kratos-entry-footer clearfix">
            
                <div class="post-like-donate text-center clearfix" id="post-like-donate">
                
                
                    <a class="share" href="javascript:;"><i class="fa fa-share-alt"></i> 分享</a>
                    <div class="share-wrap" style="display: none;">
    <div class="share-group">
        <a href="javascript:;" class="share-plain qq" onclick="share('qq');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-qq"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain qzone" onclick="share('qzone');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-star"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weixin pop style-plain" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weixin"></i>
            </div>
            <div class="share-int">
                <div class="qrcode" id="wechat-qr"></div>
                <p>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</p>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weibo" onclick="share('weibo');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weibo"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain facebook style-plain" onclick="share('facebook');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-facebook"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain twitter style-plain" onclick="share('twitter');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-twitter"></i>
            </div>
        </a>
    </div>
    <script type="text/javascript">
        $(()=>{
            new QRCode("wechat-qr", {
                text: "https://blog.windshadow.cn/SpringMVC%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8/",
                width: 150,
                height: 150,
                correctLevel : QRCode.CorrectLevel.H
            });
        });
        function share(dest) {
            const qqBase        = "https://connect.qq.com/widget/shareqq/index.html?";
            const weiboBase     = "https://service.weibo.com/share/share.php?";
            const qzoneBase     = "https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?";
            const facebookBase  = "https://www.facebook.com/sharer/sharer.php?";
            const twitterBase   = "https://twitter.com/intent/tweet?";
            const hostUrl       = "https://blog.windshadow.cn/SpringMVC%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8/";
            const title         = "「SpringMVC进阶使用」";
            const excerpt       = `Web MVC相关根据官网文档介绍总结
BindingResultBindingResult作为控制层方法的参数时，它保存了该方法BindingResult之前的参数绑定的结果，和HttpServletRequest对象一样，来自Sp...`;
            let _URL;
            switch (dest) {
                case "qq"       : _URL = qqBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";     break;
                case "weibo"    : _URL = weiboBase+"url="+hostUrl+"&title="+title+excerpt;                                 break;
                case "qzone"    : _URL = qzoneBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";  break;
                case "facebook" : _URL = facebookBase+"u="+hostUrl;                                                        break;
                case "twitter"  : _URL = twitterBase+"text="+title+excerpt+"&url="+hostUrl;                                break;
            }
            window.open(_URL);
        };
    </script>
</div>
                
                </div>
            
            <div class="footer-tag clearfix">
                <div class="pull-left">
                <i class="fa fa-tags"></i>
                    
                </div>
                <div class="pull-date">
                <span>最后编辑：2024-08-13</span>
                </div>
            </div>
        </footer>
    </div>
    
        <nav class="navigation post-navigation clearfix" role="navigation">
            
            <div class="nav-previous clearfix">
                <a title=" Nginx初入江湖" href="//Nginx初入江湖/">&lt; 上一篇</a>
            </div>
            
            
            <div class="nav-next clearfix">
                <a title=" SpringIOC常用注解和接口" href="//SpringIOC常用注解和接口/">下一篇 &gt;</a>
            </div>
            
        </nav>
    
    
</article>

        

            </section>

        

                
        </div>
    </div>
</div>
<footer>
    <div id="footer"  >
        <div class="kr-tool text-center">
            <div class="tool">
                
                    <div class="box search-box">
                        <a href="/search/">
                            <span class="fa fa-search"></span>
                        </a>
                    </div>
                
                
                    <div class="box theme-box" id="darkmode-switch">
                        <span class="fa fa-adjust"></span>
                    </div>
                
                
            </div>
            <div class="box gotop-box">
                <span class="fa fa-chevron-up"></span>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 footer-list text-center">
                    <ul class="kratos-social-icons">
                        
                        <li><a href="mailto:wsmtp@foxmail.com"><i class="fa fa-envelope"></i></a></li>
                        
                        
                        
                        
                        
                        <li><a target="_blank" rel="nofollow" href="https://github.com/WindShadow-mo"><i class="fa fa-github"></i></a></li>
                        
                    </ul>
                    <ul class="kratos-copyright">
                        <div>
                            <li>&copy; 2025 风的影子 版权所有.</li>
                            <li>本站已运行<span id="span_dt">Loading...</span></li>
                        </div>
                        <div>
                            <li>Theme <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a></li>
                            <li>Site built with&nbsp;<i class="fa fa-heart throb" style="color:#d43f57"></i>&nbsp;by 莫千风.</li>
                        </div>
                        <div>
                            <li>Powered by <a href="https://hexo.io" target="_blank" rel="nofollow">Hexo</a></li>
                            <li>Hosted on <a href="https://github.io" target="_blank">Github Pages</a></li>
                        </div>
                        <div>
                            
                            
                        </div>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>
</div>
</div>

        <script defer src="/local-cdn/npm/bootstrap@3.3.4/dist/js/bootstrap.min.js"></script>
<script defer src="/local-cdn/npm/nprogress@0.2.0/nprogress.js"></script>
<script>const notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));</script>

    <div>
        <canvas id="snow"></canvas>
        <script async type="text/javascript" src="/js/snow.min.js"></script>
    </div>

<script async src="/js/candy.min.js"></script>


    <script defer src="/local-cdn/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<script defer src="/local-cdn/npm/clipboard@2.0.6/dist/clipboard.min.js"></script>
<script defer src="/js/kratosr.min.js"></script>
<script defer src="/js/pjax.min.js"></script>


    <script defer src="/js/kr-dark.min.js"></script>



<!-- Extra support for third-party plguins  -->


    </body>
</html>